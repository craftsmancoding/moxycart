<?xml version="1.0" encoding="UTF-8"?>
<!-- http://wiki.foxycart.com/v/0.7.1/products -->
<!-- http://wiki.foxycart.com/v/1.1/coupons_and_discounts#discount_types -->
<!-- http://www.cannonlewis.com/product.php?productid=177 -->
<!-- http://www.anthropologie.com/anthro/product/shopsale-freshcuts/28810513.jsp?cm_sp=Fluid-_-28810513-_-Regular_1 -->
<!-- http://www.urbanoutfitters.com/urban/catalog/productdetail.jsp?id=28741783x&parentid=SALE_M_CLOTHING_JACKETS -->

<model package="moxycart" version="1.0" baseClass="xPDOObject" platform="mysql" defaultEngine="MyISAM">

    <!-- ! Store: a container for products -->
    <!-- Additional properties:
        default_template : which template is used for these products
        track_inventory : 
    -->
    <object class="Store" extends="modResource">
        <composite alias="Products" class="Product" local="id" foreign="parent" cardinality="many" owner="local" />
    </object>

    <!-- ! Taxonomy: a container for Terms -->
    <object class="Taxonomy" extends="modResource">
        <composite alias="Terms" class="Term" local="id" foreign="parent" cardinality="many" owner="local" />
        <validation>
            <rule field="parent" name="parent" type="xPDOValidationRule" rule="TaxonomyParents" message="Invalid parent" />
        </validation>
    </object>
    <!-- ! Terms: tags, categories, etc -->
    <object class="Term" extends="modResource">
        <aggregate alias="Taxonomy" class="Taxonomy" local="parent" foreign="id" cardinality="one" owner="foreign" />
        <!-- children terms of terms? -->
        <validation>
            <rule field="parent" name="parent" type="xPDOValidationRule" rule="TermParents" message="Invalid parent" />
        </validation>
    </object>
    
    <!-- ! Currencies -->    
	<object class="Currency" table="currencies" extends="xPDOObject">
		<field key="currency_id" dbtype="int" precision="4" phptype="integer" null="false" index="pk"  generated="native" />
		<field key="code" dbtype="varchar" precision="10" phptype="string" null="false" />
		<field key="name" dbtype="varchar" precision="256" phptype="string" null="false" />
		<field key="symbol" dbtype="varchar" precision="4" phptype="string" null="true" />
        <field key="is_active" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="1" />
		<field key="seq" dbtype="int" precision="3" phptype="integer" null="true" />

		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="currency_id" collation="A" null="false" />
		</index>
		
		<composite alias="Products" class="Product" local="currency_id" foreign="currency_id" cardinality="many" owner="local" />
	</object>

    <!-- ! Product -->
    <object class="Product" table="products" extends="xPDOObject">
        <field key="product_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
        <field key="store_id" dbtype="int" precision="11" phptype="integer" null="true" />
        <field key="parent_id" dbtype="int" precision="11" phptype="integer" null="true" comment="variations are stored as children"/>
        <field key="template_id" dbtype="int" precision="11" phptype="integer" null="true" />
        <field key="currency_id" dbtype="int" precision="4" phptype="integer" null="true" />
        <field key="name" dbtype="varchar" precision="60" phptype="string" null="false" />
        <field key="description" dbtype="varchar" precision="255" phptype="string" null="true" />
        <field key="content" dbtype="mediumtext" phptype="string" null="false" default="" />
        <field key="type" dbtype="enum" precision="'regular','subscription','download'" phptype="string" null="true" />
        <field key="sku" dbtype="varchar" precision="20" phptype="string" null="false" />
        <field key="sku_vendor" dbtype="varchar" precision="20" phptype="string" null="false" comment="SKU from your provider"/>
        <field key="variant_matrix" dbtype="varchar" precision="255" phptype="string" null="false" comment="JSON hash to identify specific type:term combo(s)"/>
        <field key="alias" dbtype="varchar" precision="255" phptype="string" null="false" />
        <field key="uri" dbtype="varchar" precision="255" phptype="string" null="false" />

        <field key="track_inventory" dbtype="tinyint" precision="1" phptype="integer" null="false" default="0" comment="Sum of child variants"/>
        <!-- in stock -->
        <field key="qty_inventory" dbtype="int" precision="11" phptype="integer" null="false" />
        <field key="qty_alert" dbtype="int" precision="11" phptype="integer" null="false" comment="Stock count at which you need to reorder"/>
        <field key="qty_min" dbtype="int" precision="11" phptype="integer" null="false" comment="Minimum quantity that should be allowed per product, per cart."/>
        <field key="qty_max" dbtype="int" precision="11" phptype="integer" null="false" comment="Maximum quantity that should be allowed per product, per cart."/>
        <field key="qty_backorder_max" dbtype="int" precision="11" phptype="integer" null="false" comment="Number of units you can oversell."/>
        <field key="price" dbtype="decimal" precision="8,2" phptype="float" null="true" />
        <field key="price_strike_thru" dbtype="decimal" precision="8,2" phptype="float" null="true" comment="Eye candy only"/>
        <field key="price_sale" dbtype="decimal" precision="8,2" phptype="float" null="true" comment="Used when on sale"/>
        <field key="sale_start" dbtype="datetime" phptype="datetime" />
        <field key="sale_end" dbtype="datetime" phptype="datetime" />
        
        <field key="category" dbtype="varchar" precision="32" phptype="string" null="true" comment="Foxycart category (not a taxonomy)"/>
        <field key="image_id" dbtype="int" precision="11" phptype="integer" null="true" comment="Thumbnail image"/>
        <field key="is_active" dbtype="tinyint" precision="1" phptype="integer" null="false" default="1" comment="Used to disable/enable products"/>
        
        
        <!-- subscription/membership products Only -->
        <field key="billing_unit" dbtype="enum" precision="'hours','days','weeks','months','years'" phptype="string" null="true" />
        <field key="billing_interval" dbtype="int" precision="3" phptype="integer" null="false" default="1"/>

        <field key="duration_unit" dbtype="enum" precision="'hours','days','weeks','months','years'" phptype="string" null="false" />
        <field key="duration_interval" dbtype="int" precision="3" phptype="integer" null="false" default="1"/>

        <field key="user_group_id" dbtype="int" precision="11" phptype="integer" null="true" />
        <field key="role_id" dbtype="int" precision="11" phptype="integer" null="true" />

        <!-- downloadable products (link to a MODX static resource)-->
        <field key="payload_id" dbtype="int" precision="11" phptype="integer" null="true"/>
        
        <field key="author_id" dbtype="int" precision="11" phptype="integer" null="true" />
		<field key="timestamp_created" dbtype="timestamp" phptype="timestamp" null="true" default="CURRENT_TIMESTAMP" />
		<field key="timestamp_modified" dbtype="timestamp" phptype="timestamp" null="true" />
        
        <field key="seq" dbtype="int" precision="3" phptype="integer" null="true" />
        
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="product_id" collation="A" null="false" />
		</index>
		<!-- sku may not be unique if variations are used -->
        <index alias="sku" name="sku" primary="false" unique="false">
			<column key="sku" collation="A" null="true" />
		</index>
        <index alias="factory_sku" name="factory_sku" primary="false" unique="false">
			<column key="factory_sku" collation="A" null="true" />
		</index>
        <index alias="alias" name="alias" primary="false" unique="true"  type="BTREE">
			<column key="store_id" collation="A" null="true" />
			<column key="alias" collation="A" null="true" />
		</index>

        <index alias="uri" name="uri" primary="false" unique="true"  type="BTREE">
			<column key="uri" collation="A" null="false" />
		</index>

        <index alias="image_id" name="image_id" primary="false" unique="false">
			<column key="image_id" collation="A" null="true" />
		</index>
				
		<aggregate alias="Store" class="Store" local="store_id" foreign="id" cardinality="one" owner="foreign" />
		<aggregate alias="Template" class="modTemplate" local="template_id" foreign="id" cardinality="one" owner="foreign" />
		<aggregate alias="Currency" class="Currency" local="currency_id" foreign="currency_id" cardinality="one" owner="foreign" />
		<aggregate alias="Payload" class="modResource" local="payload_id" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="Author" class="modUser" local="author_id" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="UserGroup" class="modUserGroup" local="user_group_id" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="Role" class="modUserGroupRole" local="role_id" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="Thumbnail" class="Image" local="image_id" foreign="image_id" cardinality="one" owner="foreign" />
        
        <!-- parent is the main product: children represent variants in all permutations -->
        <composite alias="Parent" class="Product" local="parent_id" foreign="product_id" cardinality="one" owner="foreign" />
        <aggregate alias="Variant" class="Product" local="product_id" foreign="parent_id" cardinality="many" owner="local" />
		
		<composite alias="Images" class="Image" local="product_id" foreign="product_id" cardinality="many" owner="local" />
		<composite alias="Terms" class="ProductTerm" local="product_id" foreign="product_id" cardinality="many" owner="local" />
        <composite alias="Specs" class="ProductSpec" local="product_id" foreign="product_id" cardinality="many" owner="local" />
		<composite alias="Related" class="RelatedProducts" local="product_id" foreign="product_id" cardinality="many" owner="local" />
    </object>


	<!-- ! Specs -->
	<!-- a la custom fields-->
	<object class="Spec" table="specs" extends="xPDOObject">
		<field key="spec_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
		<field key="name" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="description" dbtype="varchar" precision="255" phptype="string" null="true" />
		<field key="seq" dbtype="tinyint" precision="3" phptype="integer" null="true" />
		<field key="group" dbtype="varchar" precision="32" phptype="string" null="true" />
		<!-- future use? -->
		<field key="type" dbtype="varchar" precision="32" phptype="string" null="false" default="text"/>
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="spec_id" collation="A" null="false" />
		</index>
        <index alias="name" name="name" primary="false" unique="true"  type="BTREE">
			<column key="name" collation="A" null="false" />
		</index>


		
	</object>

    <!-- ! ProductSpec -->
    <!-- custom fields for specifying height, weight etc. -->
	<object class="ProductSpec" table="product_specs" extends="xPDOSimpleObject">
		<field key="product_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        <field key="spec_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        <field key="value" dbtype="varchar" precision="255" phptype="string" null="false" />
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="id" collation="A" null="false" />
		</index>

        <aggregate alias="Products" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
        <aggregate alias="Spec" class="Spec" local="spec_id" foreign="spec_id" cardinality="one" owner="foreign" />
	</object>


	<!-- ! Variation Types -->
	<!-- eg. "Color", "Size", "Material" -->
	<object class="VariationType" table="variation_types" extends="xPDOObject">
		<field key="vtype_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
		<field key="name" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="description" dbtype="varchar" precision="255" phptype="string" null="true" />
		<field key="seq" dbtype="int" precision="4" phptype="integer" null="true" />

		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="vtype_id" collation="A" null="false" />
		</index>
        <index alias="name" name="name" primary="false" unique="true">
			<column key="name" collation="A" null="true" />
		</index>		
		
		<composite alias="Terms" class="VariationTerm" local="vtype_id" foreign="vtype_id" cardinality="many" owner="local" />
	</object>

    <!-- ! Variation Terms -->
    <!-- e.g. "Small", "Medium", "Large" -->
	<object class="VariationTerm" table="variation_terms" extends="xPDOObject">
    	<field key="vterm_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
		<field key="vtype_id" dbtype="int" precision="11" phptype="integer" null="false"/>
		<field key="name" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="sku_prefix" dbtype="varchar" precision="16" phptype="string" null="false" />
		<field key="sku_suffix" dbtype="varchar" precision="16" phptype="string" null="false" />
		<field key="seq" dbtype="tinyint" precision="3" phptype="integer" null="true" />
		
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="vterm_id" collation="A" null="false" />
		</index>

        <aggregate alias="Type" class="VariationType" local="vtype_id" foreign="vtype_id" cardinality="one" owner="foreign" />
	</object>

	<!-- ! Product Variation Types -->
	<!-- 
	e.g. says "this parent product varies by Color, Size, and Material 
	is_variant: if 1, this means that price, qty, etc. will change for the product 
	is_variant: if 0, then the options here are just aesthetic options
	-->
	<object class="ProductVariationTypes" table="product_variation_types" extends="xPDOSimpleObject">
		<field key="product_id" dbtype="int" precision="11" phptype="integer" null="false"/>
		<field key="vtype_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        <field key="name" dbtype="varchar" precision="255" phptype="string" null="false" />
        <field key="seq" dbtype="tinyint" precision="3" phptype="integer" null="true" />
		<field key="is_variant" dbtype="tinyint" precision="1" phptype="integer" null="false" default="0" />
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="id" collation="A" null="false" />
		</index>
		
        <aggregate alias="Type" class="VariationType" local="vtype_id" foreign="vtype_id" cardinality="one" owner="foreign" />
        <aggregate alias="Product" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
	</object>
	
    <!-- ! ProductTaxonomy -->
    <!-- for enabling taxonomies at the product level -->
	<object class="ProductTaxonomy" table="product_taxonomies" extends="xPDOSimpleObject">
		<field key="product_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        <field key="taxonomy_id" dbtype="int" precision="11" phptype="integer" null="false"/>
		<field key="seq" dbtype="tinyint" precision="3" phptype="integer" null="true" />		
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="id" collation="A" null="false" />
		</index>

        <aggregate alias="Taxonomy" class="Taxonomy" local="taxonomy_id" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="Products" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
	</object>
	    
    <!-- ! ProductTerm -->
    <!-- for adding tags/categories to products -->
	<object class="ProductTerm" table="product_terms" extends="xPDOSimpleObject">
		<field key="product_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        <field key="term_id" dbtype="int" precision="11" phptype="integer" null="false"/>
		<field key="seq" dbtype="tinyint" precision="3" phptype="integer" null="true" />		
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="id" collation="A" null="false" />
		</index>

        <aggregate alias="Term" class="Term" local="term_id" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="Products" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
	</object>
	
	
	<!-- ! Coupons -->
	
	    
    <!-- ! Carts -->
    <!-- 
    what if you have multiple currencies in the cart? 
    how to handle variations?
    -->
	<object class="Cart" table="carts" extends="xPDOObject">
    	<field key="cart_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
		<field key="product_id" dbtype="int" precision="11" phptype="integer" null="false"/>

        <field key="price" dbtype="decimal" precision="8,2" phptype="float" null="true" />
        <field key="currency_id" dbtype="int" precision="4" phptype="integer" null="true" />
		<field key="qty" dbtype="int" precision="11" phptype="integer" null="false" default="0"/>

        <field key="info" dbtype="text" phptype="string" null="true" comment="JSON data including varations/options"/>

        <field key="author_id" dbtype="int" precision="11" phptype="integer" null="true" comment="user may not be logged in"/>
		<field key="timestamp_created" dbtype="timestamp" phptype="timestamp" null="true" default="CURRENT_TIMESTAMP" />
		<field key="timestamp_modified" dbtype="timestamp" phptype="timestamp" null="true" />

		
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="cart_id" collation="A" null="false" />
		</index>

        <aggregate alias="Product" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
        <aggregate alias="Author" class="modUser" local="author_id" foreign="id" cardinality="one" owner="foreign" />
        
	</object>
    

    <!-- ! RelatedProducts -->
    <!-- for linking products together -->
	<object class="RelatedProducts" table="related_products" extends="xPDOSimpleObject">
		<field key="product_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        <field key="related_id" dbtype="int" precision="11" phptype="integer" null="false"/>
		<field key="seq" dbtype="tinyint" precision="3" phptype="integer" null="true" />		
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="id" collation="A" null="false" />
		</index>

        <aggregate alias="Product" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
        <aggregate alias="Related" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
	</object>

	<!-- ! Image -->
	<!-- Each Product can have multiple images -->
	<object class="Image" table="images" extends="xPDOObject">
    	<field key="image_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
    	<field key="product_id" dbtype="int" precision="11" phptype="integer" null="true"/>
		<field key="title" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="alt" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="url" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="path" dbtype="varchar" precision="255" phptype="string" null="true" />
		<field key="width" dbtype="int" precision="4" phptype="integer" null="false" />
		<field key="height" dbtype="int" precision="4" phptype="integer" null="false" />
		<field key="seq" dbtype="int" precision="4" phptype="integer" null="false" />
		<field key="is_active" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="1" />
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="image_id" collation="A" null="false" />
		</index>

		<aggregate alias="Product" class="Product" local="product_id" foreign="product_id" cardinality="one" owner="foreign" />
	</object>

    <!-- ! ================= Foxycart Datafeed ================= -->
    <!-- See https://wiki.foxycart.com/v/1.1/transaction_xml_datafeed -->
    <!-- ! Foxydata -->
    <object class="Foxydata" table="foxydata" extends="xPDOObject">
        <field key="foxydata_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
        <!--field key="store_version" dbtype="varchar" precision="32" phptype="string" null="false" /-->
        <field key="md5" dbtype="varchar" precision="32" phptype="string" null="false" comment="Used to uniquely id the data payload"/>
        <field key="xml" dbtype="mediumtext" phptype="string" null="false" default="" comment="Decrypted XML body"/>
        <field key="timestamp_created" dbtype="timestamp" phptype="timestamp" null="true" default="CURRENT_TIMESTAMP" />
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="foxydata_id" collation="A" null="false" />
		</index>
        <index alias="md5" name="md5" primary="false" unique="true"  type="BTREE">
			<column key="md5" collation="A" null="false" />
		</index>
        <composite alias="Transactions" class="Transaction" local="foxydata_id" foreign="foxydata_id" cardinality="many" owner="local" />
    </object>
    
    <!-- ! Transactions -->
    <!-- A billing event. For the list of products purchased, see TransactionDetail -->
	<object class="Transaction" table="transactions" extends="xPDOObject">
    	<field key="transaction_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
    	<field key="id" dbtype="int" precision="11" phptype="integer" null="false" comment="Foxycart unique transaction id"/>
		<field key="store_id" dbtype="int" precision="11" phptype="integer" null="false" />
		<field key="store_version" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="is_test" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="1" />
		<field key="is_hidden" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="0" />
		<field key="data_is_fed" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="1" />
		<field key="transaction_date" dbtype="timestamp" phptype="timestamp" null="true" />
		
		<field key="payment_type" dbtype="varchar" precision="16" phptype="string" null="false" />
		<field key="payment_gateway_type" dbtype="varchar" precision="16" phptype="string" null="false" />
		<field key="processor_response" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="processor_response_details" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="purchase_order" dbtype="varchar" precision="16" phptype="string" null="false" />		
		
		<field key="cc_number_masked" dbtype="varchar" precision="20" phptype="string" null="false" />
		<field key="cc_type" dbtype="varchar" precision="16" phptype="string" null="false" />		
		
		<field key="cc_exp_month" dbtype="int" precision="2" phptype="integer" attributes="ZEROFILL UNSIGNED" null="false" />
		<field key="cc_exp_year" dbtype="int" precision="4" phptype="integer" null="false" />
		<field key="cc_start_date_month" dbtype="int" precision="2" phptype="integer" attributes="ZEROFILL UNSIGNED" null="true" />
		<field key="cc_start_date_year" dbtype="int" precision="4" phptype="integer" null="true" />
		<field key="cc_issue_number" dbtype="int" precision="2" phptype="integer" null="true" />
		<field key="minfraud_score" dbtype="int" precision="4" phptype="integer" null="true" />
		<field key="paypal_payer_id" dbtype="varchar" precision="255" phptype="string" null="true" />
		
		<field key="customer_id" dbtype="int" precision="11" phptype="integer" null="false" comment="Foxycart customer"/>

		<field key="is_anonymous" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="0" />
		
		<field key="customer_first_name" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="customer_last_name" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="customer_company" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="customer_address1" dbtype="varchar" precision="64" phptype="string" null="false" />
		<field key="customer_address2" dbtype="varchar" precision="64" phptype="string" null="false" />
		<field key="customer_city" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="customer_state" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="customer_postal_code" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="customer_country" dbtype="varchar" precision="2" phptype="string" null="false" />
		<field key="customer_phone" dbtype="varchar" precision="16" phptype="string" null="true" />
		<field key="customer_email" dbtype="varchar" precision="64" phptype="string" null="true" />
		<field key="customer_ip" dbtype="varchar" precision="16" phptype="string" null="true" />

		<field key="shipping_first_name" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="shipping_last_name" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="shipping_company" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="shipping_address1" dbtype="varchar" precision="64" phptype="string" null="false" />
		<field key="shipping_address2" dbtype="varchar" precision="64" phptype="string" null="false" />
		<field key="shipping_city" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="shipping_state" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="shipping_postal_code" dbtype="varchar" precision="32" phptype="string" null="false" />
		<field key="shipping_country" dbtype="varchar" precision="2" phptype="string" null="false" />
		<field key="shipping_phone" dbtype="varchar" precision="16" phptype="string" null="true" />
		<field key="shipto_shipping_service_description" dbtype="varchar" precision="64" phptype="string" null="true" />

		<!-- money -->
		<field key="product_total" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
		<field key="tax_total" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
		<field key="shipping_total" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
		<field key="order_total" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
		
		<field key="receipt_url" dbtype="varchar" precision="255" phptype="string" null="false" />
		
		<field key="customer_password" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="customer_password_salt" dbtype="varchar" precision="255" phptype="string" null="false" />
		<field key="customer_password_hash_type" dbtype="varchar" precision="8" phptype="string" null="false" />
		<field key="customer_password_hash_config" dbtype="varchar" precision="8" phptype="string" null="false" comment="Not sure what this stores"/>
		
		<field key="shipto_addresses" dbtype="varchar" precision="255" phptype="string" null="false" />		

		
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="transaction_id" collation="A" null="false" />
		</index>

        <!-- We use the id field to adhere exactly to Foxycart's naming conventions -->
        <index alias="id" name="id" primary="false" unique="true"  type="BTREE">
			<column key="id" collation="A" null="false" />
		</index>
        <index alias="receipt_url" name="receipt_url" primary="false" unique="true"  type="BTREE">
			<column key="receipt_url" collation="A" null="false" />
		</index>


		<aggregate alias="Data" class="Foxydata" local="foxydata_id" foreign="foxydata_id" cardinality="one" owner="foreign" />
		<composite alias="Taxes" class="Tax" local="transaction_id" foreign="transaction_id" cardinality="many" owner="local" />
		<composite alias="Discounts" class="Discount" local="transaction_id" foreign="transaction_id" cardinality="many" owner="local" />
		<composite alias="Attributes" class="Attribute" local="transaction_id" foreign="transaction_id" cardinality="many" owner="local" />
		<composite alias="CustomFields" class="CustomField" local="transaction_id" foreign="transaction_id" cardinality="many" owner="local" />
		<composite alias="Details" class="TransactionDetail" local="transaction_id" foreign="transaction_id" cardinality="many" owner="local" />
		<composite alias="ShiptoAddresses" class="ShiptoAddress" local="transaction_id" foreign="transaction_id" cardinality="many" owner="local" />

	</object>
	
	<!-- ! Tax -->
	<object class="Tax" table="taxes" extends="xPDOObject">
        <field key="tax_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
        <field key="transaction_id" dbtype="int" precision="11" phptype="integer" null="false" />
        
        <field key="tax_rate" dbtype="decimal" precision="6,4" phptype="float" null="false" default="0.0000" />
        <field key="tax_name" dbtype="varchar" precision="32" phptype="string" null="false" />
        <field key="tax_amount" dbtype="decimal" precision="6,4" phptype="float" null="false" default="0.0000"/>
        
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="tax_id" collation="A" null="false" />
		</index>
		
		<aggregate alias="Transaction" class="Transaction" local="transaction_id" foreign="transaction_id" cardinality="one" owner="foreign" />      
    </object>

	<!-- ! Discount -->
	<object class="Discount" table="discounts" extends="xPDOObject">
        <field key="discount_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
        <field key="transaction_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        <field key="code" dbtype="varchar" precision="32" phptype="string" null="false" />
        <field key="valid_categories" dbtype="varchar" precision="255" phptype="string" null="false" comment="???"/>
        <field key="name" dbtype="varchar" precision="32" phptype="string" null="false" />
        <field key="amount" dbtype="decimal" precision="6,4" phptype="float" null="false" default="0.0000" />
        <field key="display" dbtype="varchar" precision="32" phptype="string" null="false" />
        <field key="coupon_discount_type" dbtype="varchar" precision="32" phptype="string" null="false" />         
        <field key="coupon_discount_details" dbtype="varchar" precision="32" phptype="string" null="false" />                 
                
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="discount_id" collation="A" null="false" />
		</index>
		
		<aggregate alias="Transaction" class="Transaction" local="transaction_id" foreign="transaction_id" cardinality="one" owner="foreign" />
    </object>
    
    <!-- ! CustomField -->
	<object class="CustomField" table="customfields" extends="xPDOObject" comment="Foxycart transaction customfields">
        <field key="customfield_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
        <field key="transaction_id" dbtype="int" precision="11" phptype="integer" null="false" />
        
        <field key="custom_field_name" dbtype="varchar" precision="32" phptype="string" null="false" />
        <field key="custom_field_value" dbtype="varchar" precision="255" phptype="string" null="false" />
        <field key="custom_field_is_hidden" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="0" />
        
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="customfield_id" collation="A" null="false" />
		</index>
		
		<aggregate alias="Transaction" class="Transaction" local="transaction_id" foreign="transaction_id" cardinality="one" owner="foreign" />      
    </object>
    
    <!-- ! Attribute -->
	<object class="Attribute" table="attributes" extends="xPDOObject" comment="Foxycart transaction attributes">
        <field key="attribute_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" />
        <field key="transaction_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        
        <field key="name" dbtype="varchar" precision="32" phptype="string" null="false" />
        <field key="value" dbtype="varchar" precision="255" phptype="string" null="false" />
        
		<index alias="PRIMARY" name="PRIMARY" primary="true" unique="true">
			<column key="attribute_id" collation="A" null="false" />
		</index>
		
		<aggregate alias="Transaction" class="Transaction" local="transaction_id" foreign="transaction_id" cardinality="one" owner="foreign" />      
    </object>
       
    <!-- ! TransactionDetail -->
	<object class="TransactionDetail" table="transactiondetails" extends="xPDOSimpleObject" comment="Foxycart transaction details">
        <field key="transaction_id" dbtype="int" precision="11" phptype="integer" null="false" />
        <field key="product_name" dbtype="varchar" precision="255" phptype="string" null="false" />
        <field key="product_price" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
        <field key="product_quantity" dbtype="int" precision="11" phptype="integer" null="false" />
        <field key="product_weight" dbtype="decimal" precision="8,4" phptype="float" null="false" default="0.0000" />
        <field key="product_code" dbtype="int" precision="11" phptype="integer" null="false" comment="This should be a link back to the products table"/>
        
        <field key="downloadable_url" dbtype="varchar" precision="255" phptype="string" null="true" />
        <field key="sub_token_url" dbtype="varchar" precision="255" phptype="string" null="true" />
        <field key="subscription_frequency" dbtype="varchar" precision="8" phptype="string" null="true" comment="e.g. 1m"/>
        <field key="subscription_startdate" dbtype="date" phptype="datetime" null="true" default="0000-00-00" />
        <field key="subscription_nextdate" dbtype="date" phptype="datetime" null="true" default="0000-00-00" />
        <field key="subscription_enddate" dbtype="date" phptype="datetime" null="true" default="0000-00-00" />                
        <field key="is_future_line_item" dbtype="tinyint" precision="1" attributes="unsigned" phptype="boolean" null="false" default="0" />
        <field key="shipto" dbtype="varchar" precision="255" phptype="string" null="true" comment="???"/>
        
        <field key="category_description" dbtype="varchar" precision="255" phptype="string" null="true" />
        <field key="category_code" dbtype="varchar" precision="255" phptype="string" null="true" />
        <field key="product_delivery_type" dbtype="varchar" precision="255" phptype="string" null="true" />
        
		<aggregate alias="Transaction" class="Transaction" local="transaction_id" foreign="transaction_id" cardinality="one" owner="foreign" />
		<composite alias="Options" class="TransactionDetailOption" local="id" foreign="transactiondetail_id" cardinality="many" owner="local" /> 
    </object>
            
    <!-- ! TransactionDetailOption -->
    <object class="TransactionDetailOption" table="transactiondetailoptions" extends="xPDOSimpleObject" comment="Foxycart options for transaction detail (i.e. product options)">
        <field key="transactiondetail_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        
        <!-- Ideally, this would be a fk back to a vtype_id -->
        <field key="product_option_name" dbtype="varchar" precision="32" phptype="string" null="false" />
        <field key="product_option_value" dbtype="varchar" precision="255" phptype="string" null="false" />
        <field key="price_mod" dbtype="decimal" precision="8,3" phptype="float" null="false" default="0.000" />
        <field key="weight_mod" dbtype="decimal" precision="8,3" phptype="float" null="false" default="0.000" />
        
		<aggregate alias="TransactionDetail" class="TransactionDetail" local="transactiondetail_id" foreign="id" cardinality="one" owner="foreign" />
    </object>

    <!-- ! ShiptoAddress-->
    <!-- This may only be relevant to a multiship store (?)-->
	<object class="ShiptoAddress" table="shipto_addresses" extends="xPDOSimpleObject" comment="Foxycart shipto addresses">
        <field key="transaction_id" dbtype="int" precision="11" phptype="integer" null="false"/>
        	    
        <field key="address_id" dbtype="int" precision="11" phptype="integer" null="false" comment="Passed by Foxycart (?)"/>
        <field key="address_name" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_first_name" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_last_name" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_company" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_address1" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_address2" dbtype="varchar" precision="64" phptype="string" null="false" />

        <field key="shipto_city" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_state" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_postal_code" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="shipto_country" dbtype="varchar" precision="64" phptype="string" null="false" />
        <field key="date_created" dbtype="datetime" phptype="datetime" />
        <field key="date_modified" dbtype="datetime" phptype="datetime" />
        <field key="shipto_shipping_service_description" dbtype="varchar" precision="255" phptype="string" null="false" />
        
        <field key="shipto_subtotal" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
        <field key="shipto_tax_total" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
        <field key="shipto_shipping_total" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
        <field key="shipto_total" dbtype="decimal" precision="8,2" phptype="float" null="false" default="0.00" />
        
        <!-- shipto_custom_fields TODO??? -->
		
		<aggregate alias="Transaction" class="Transaction" local="transaction_id" foreign="transaction_id" cardinality="one" owner="foreign" />      
    </object>

</model>